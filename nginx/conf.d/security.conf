# Security configuration for Nginx
# /etc/nginx/conf.d/security.conf

# Hide Nginx version
server_tokens off;

# Prevent access to hidden files
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
}

# Prevent access to backup files
location ~ ~$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Block access to sensitive files
location ~* \.(htaccess|htpasswd|ini|log|sh|sql|conf)$ {
    deny all;
    access_log off;
    log_not_found off;
}

# Block common exploit attempts
location ~* (wp-admin|wp-login|wp-config|phpMyAdmin|phpmyadmin|mysql|admin|administrator) {
    deny all;
    access_log off;
    log_not_found off;
}

# Block user agents
if ($http_user_agent ~* (nmap|nikto|wikto|sf|sqlmap|bsqlbf|w3af|acunetix|havij|appscan)) {
    return 444;
}

# Block suspicious requests
if ($request_method !~ ^(GET|HEAD|POST|PUT|DELETE|OPTIONS)$ ) {
    return 444;
}

# Block requests with no referrer and suspicious user agents
if ($http_referer ~* (babes|forsale|girl|jewelry|love|nudit|organic|poker|porn|sex|teen)) {
    return 444;
}

# Additional security measures
add_header X-Robots-Tag "noindex, nofollow, nosnippet, noarchive" always;

# Rate limiting for security
limit_req_zone $binary_remote_addr zone=security:10m rate=1r/s;

# Apply security rate limit to sensitive paths
location ~* \.(php|asp|aspx|jsp)$ {
    limit_req zone=security burst=1 nodelay;
    deny all;
}